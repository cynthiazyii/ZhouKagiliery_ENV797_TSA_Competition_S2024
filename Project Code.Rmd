---
title: "Forecasting Competition Attempt 1"
author: "Julia Kagiliery & Cynthia Zhou"
output: pdf_document
---

```{r package, message=FALSE, warning=FALSE}
library(lubridate)
library(ggplot2)
library(forecast)  
library(Kendall)
library(tseries)
library(outliers)
library(tidyverse)
library(smooth)
library(zoo)
library(kableExtra)
library(readxl)
library(dplyr)
```

```{r}
HourlyData <- read_excel("./Data/load.xlsx", col_types = c("skip", 
    "date", "numeric", "numeric", "numeric", 
    "numeric", "numeric", "numeric", "numeric", 
    "numeric", "numeric", "numeric", "numeric", 
    "numeric", "numeric", "numeric", "numeric", 
    "numeric", "numeric", "numeric", "numeric", 
    "numeric", "numeric", "numeric", "numeric", 
    "numeric"))

Dates <-HourlyData[,1]

Loads <- HourlyData[,2:25]

Loads <- Loads |>
  mutate(
    DailyAverage = rowMeans(across(everything())))

AverageDaily <- cbind(Loads, Dates$date)

AverageDaily <- AverageDaily[,25:26] 

colnames(AverageDaily) <- c("DailyAve", "Date")

view(AverageDaily)
```

This is not the best way to do it but AverageDaily data set contains the average of the 24 hours (column name = DailyAve) and the date (titled "Date").

Code inspiration: https://www.geeksforgeeks.org/calculate-the-mean-of-each-row-of-an-object-in-r-programming-rowmeans-function/

```{r}
AverageDaily %>%
  ggplot(aes(y = DailyAve, x = Date)) +  # Close aes() here
  geom_line()
```

```{r}
TSDaily <- msts(AverageDaily[,1], start = c(2005, 01, 01), c(7,30,365))
autoplot(TSDaily)
```

```{r message=FALSE, warning=FALSE}
#create a subset for training purpose
n_for = 365+181 # remove data in 01/2010 to 06/2011
TSDaily_train <- subset(TSDaily, end = length(TSDaily)-n_for)

#create a subset for testing purpose
TSDaily_test <- subset(TSDaily, start = length(TSDaily)-n_for)

autoplot(TSDaily_train)
autoplot(TSDaily_test)
```

### Model 1: STL + ETS

```{r ETS, echo=TRUE, message=FALSE, warning=FALSE}
#Test the model by comparing data in 2010
#Fit and forecast STL + ETS model to data
ETS_fit_test <-  stlf(TSDaily_train,h=365)

#Plot model + observed data
autoplot(TSDaily) +
  autolayer(ETS_fit_test, series="STL + ETS",PI=FALSE) +
  ylab("Active Power")

#re-run
ETS_fit <-  stlf(TSDaily,h=31)
autoplot(TSDaily) +
  autolayer(ETS_fit, series="STL + ETS",PI=FALSE) +
  ylab("Active Power")
```

### Output
```{r output}
date <- seq(as.Date("2011-07-01"), as.Date("2011-07-31"), by = "day")
load <- ETS_fit$mean
ETS_output <- cbind.data.frame(date, load)
write.csv(ETS_output, "ETS_output.csv", row.names = FALSE)
```
